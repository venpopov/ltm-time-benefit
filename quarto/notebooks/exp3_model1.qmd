---
title: "Experiment 3"
format: html
---

```{r}
#| label: init
#| message: false
library(tidyverse)
library(targets)
tar_source()
tar_load(c(exp3_data_agg))
```

## Basic fit

TODO: Replace this with results from the targets pipeline

```{r}
est <- estimate_model(
  start = paper_params(),
  data = exp3_data_agg,
  two_step = TRUE,
  exclude_sp1 = TRUE,
  simplify = TRUE,
  prior = list(
    rate = list(mean = 0.05, sd = 0.01)
  )
)

est
```

```{r}
#| label: exp3_performance
#| fig-width: 8.5
#| fig-height: 5
exp3_data_agg$pred <- predict(est$fit[[1]], data = exp3_data_agg, group_by = c("chunk", "gap"))

exp3_data_agg |>
  ggplot(aes(gap, p_correct, color = chunk, group = chunk)) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE) +
  geom_line(aes(y = pred), color = "black") +
  scale_color_discrete("1st chunk LTM?") +
  facet_wrap(~itemtype) +
  theme_pub()

```
