{
  "hash": "77a0c817001bf0a69dc53680f619a426",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Parameter identifiability\"\nformat: \n  html:\n    html-table-processing: none\n---\n\n\n## Overview\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(targets)\nlibrary(GGally)\nlibrary(kableExtra)\ntar_source()\n```\n:::\n\n\nIn [the initial modeling notebook](modelling_edas_approach.qmd#problem-with-parameter-identifiability), I discovered some problems with parameter identifiability. Here I will explore this issue further.\n\nInitially I ran the model described in the May 13, 2024 draft with 100 different starting parameters. Here are 5 sets of very different best-fitting parameters that produce nearly identical fits as measured by the negative log-likelihood (deviance):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfits <- readRDS(\"output/five_parsets_exp2.rds\")\nfits$set <- paste0(\"set\", 1:5)\n\nfits[, 1:6] |>\n  as.data.frame() |>\n  `rownames<-`(fits$set) |>\n  kbl() %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> prop </th>\n   <th style=\"text-align:right;\"> prop_ltm </th>\n   <th style=\"text-align:right;\"> rate </th>\n   <th style=\"text-align:right;\"> tau </th>\n   <th style=\"text-align:right;\"> gain </th>\n   <th style=\"text-align:right;\"> deviance </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> set1 </td>\n   <td style=\"text-align:right;\"> 0.098 </td>\n   <td style=\"text-align:right;\"> 0.815 </td>\n   <td style=\"text-align:right;\"> 0.006 </td>\n   <td style=\"text-align:right;\"> 0.084 </td>\n   <td style=\"text-align:right;\"> 96.954 </td>\n   <td style=\"text-align:right;\"> 40.377 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> set2 </td>\n   <td style=\"text-align:right;\"> 0.132 </td>\n   <td style=\"text-align:right;\"> 0.818 </td>\n   <td style=\"text-align:right;\"> 0.009 </td>\n   <td style=\"text-align:right;\"> 0.108 </td>\n   <td style=\"text-align:right;\"> 54.078 </td>\n   <td style=\"text-align:right;\"> 40.429 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> set3 </td>\n   <td style=\"text-align:right;\"> 0.155 </td>\n   <td style=\"text-align:right;\"> 0.820 </td>\n   <td style=\"text-align:right;\"> 0.010 </td>\n   <td style=\"text-align:right;\"> 0.123 </td>\n   <td style=\"text-align:right;\"> 40.135 </td>\n   <td style=\"text-align:right;\"> 40.491 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> set4 </td>\n   <td style=\"text-align:right;\"> 0.173 </td>\n   <td style=\"text-align:right;\"> 0.822 </td>\n   <td style=\"text-align:right;\"> 0.011 </td>\n   <td style=\"text-align:right;\"> 0.133 </td>\n   <td style=\"text-align:right;\"> 32.738 </td>\n   <td style=\"text-align:right;\"> 40.556 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> set5 </td>\n   <td style=\"text-align:right;\"> 0.215 </td>\n   <td style=\"text-align:right;\"> 0.826 </td>\n   <td style=\"text-align:right;\"> 0.013 </td>\n   <td style=\"text-align:right;\"> 0.154 </td>\n   <td style=\"text-align:right;\"> 21.967 </td>\n   <td style=\"text-align:right;\"> 40.772 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe can see that they all produce nearly identical predictions (the lines are the model predictions, the points are the data):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfits |>\n  mutate(pred = map2(fit, data, \\(x, y) predict(x, y, group_by = c(\"chunk\", \"gap\")))) |>\n  unnest(c(data, pred)) |>\n  mutate(gap = as.factor(gap)) |>\n  ggplot(aes(x = gap, y = p_correct, color = chunk)) +\n  geom_point() +\n  geom_line(aes(y = pred, linetype = set, group = interaction(chunk, set))) +\n  scale_color_discrete(\"First chunk LTM?\") +\n  scale_linetype_discrete(\"Parameter set\") +\n  facet_grid(~itemtype) +\n  theme_pub()\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot five fits-1.png){width=816}\n:::\n:::\n\n\nThe plot below shows the strong nearly linear trade-offs between the parameters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfits |>\n  select(prop, rate, tau, gain) |>\n  ggpairs(\n    diag = list(continuous = \"blankDiag\"),\n    upper = list(continuous = \"points\")\n  ) +\n  theme_pub() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot par correlations-1.png){width=816}\n:::\n:::\n\n\n## Fix rate to different values and explore the parameter space\n\nI ran a simulation in which I fix[^1] the rate parameter to values in the range 0.005 to 0.2. I want to see if the identical fits extend to higher rates.\n\n[^1]: technically, I put a really narrow prior Normal(value, 0.0001) on the rate parameter rather than fixing it just because I can do it in the existing code.\n\nWe first extract the best-fitting parameters for each rate from the 100 random start fits.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntar_load(fits2)\nfits2 <- fits2 |>\n  mutate(\n    deviance = pmap_dbl(list(fit, data, exclude_sp1), function(x, y, z) {\n      overall_deviance(x$par, data = y, exclude_sp1 = z)\n    }),\n    rate = round(rate, 3)\n  )\n\n\nbest <- fits2 |>\n  group_by(rate, exp, exclude_sp1) |>\n  filter(deviance == min(deviance)) |>\n  slice(1) |>\n  select(rate, prop, prop_ltm, tau, gain, deviance, fit, data) |>\n  mutate(pred = map2(fit, data, \\(x, y) predict(x, y, group_by = c(\"chunk\", \"gap\")))) |>\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAdding missing grouping variables: `exp`, `exclude_sp1`\n```\n\n\n:::\n:::\n\n\nsubset for exp2 and exclude_sp1 = TRUE\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_subset <- filter(best, exp == 2, exclude_sp1)\n```\n:::\n\n\nFrom the deviance it's already clear that the fits get wose once we get above 0.020 rate. Here are the best-fitting parameters for each rate:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_subset |>\n  select(rate, prop, prop_ltm, tau, gain, deviance) |>\n  mutate_all(round, 3) |>\n  kbl() %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> rate </th>\n   <th style=\"text-align:right;\"> prop </th>\n   <th style=\"text-align:right;\"> prop_ltm </th>\n   <th style=\"text-align:right;\"> tau </th>\n   <th style=\"text-align:right;\"> gain </th>\n   <th style=\"text-align:right;\"> deviance </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.005 </td>\n   <td style=\"text-align:right;\"> 0.098 </td>\n   <td style=\"text-align:right;\"> 0.812 </td>\n   <td style=\"text-align:right;\"> 0.084 </td>\n   <td style=\"text-align:right;\"> 100.000 </td>\n   <td style=\"text-align:right;\"> 42.689 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.010 </td>\n   <td style=\"text-align:right;\"> 0.155 </td>\n   <td style=\"text-align:right;\"> 0.819 </td>\n   <td style=\"text-align:right;\"> 0.121 </td>\n   <td style=\"text-align:right;\"> 41.585 </td>\n   <td style=\"text-align:right;\"> 40.518 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.015 </td>\n   <td style=\"text-align:right;\"> 0.235 </td>\n   <td style=\"text-align:right;\"> 0.826 </td>\n   <td style=\"text-align:right;\"> 0.159 </td>\n   <td style=\"text-align:right;\"> 19.374 </td>\n   <td style=\"text-align:right;\"> 40.871 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.020 </td>\n   <td style=\"text-align:right;\"> 0.316 </td>\n   <td style=\"text-align:right;\"> 0.835 </td>\n   <td style=\"text-align:right;\"> 0.183 </td>\n   <td style=\"text-align:right;\"> 11.537 </td>\n   <td style=\"text-align:right;\"> 41.687 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.025 </td>\n   <td style=\"text-align:right;\"> 0.389 </td>\n   <td style=\"text-align:right;\"> 0.841 </td>\n   <td style=\"text-align:right;\"> 0.194 </td>\n   <td style=\"text-align:right;\"> 8.143 </td>\n   <td style=\"text-align:right;\"> 43.185 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> 0.451 </td>\n   <td style=\"text-align:right;\"> 0.844 </td>\n   <td style=\"text-align:right;\"> 0.197 </td>\n   <td style=\"text-align:right;\"> 6.359 </td>\n   <td style=\"text-align:right;\"> 45.610 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.035 </td>\n   <td style=\"text-align:right;\"> 0.496 </td>\n   <td style=\"text-align:right;\"> 0.842 </td>\n   <td style=\"text-align:right;\"> 0.197 </td>\n   <td style=\"text-align:right;\"> 5.394 </td>\n   <td style=\"text-align:right;\"> 49.069 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.040 </td>\n   <td style=\"text-align:right;\"> 0.528 </td>\n   <td style=\"text-align:right;\"> 0.834 </td>\n   <td style=\"text-align:right;\"> 0.196 </td>\n   <td style=\"text-align:right;\"> 4.765 </td>\n   <td style=\"text-align:right;\"> 53.434 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.045 </td>\n   <td style=\"text-align:right;\"> 0.324 </td>\n   <td style=\"text-align:right;\"> 0.465 </td>\n   <td style=\"text-align:right;\"> 0.210 </td>\n   <td style=\"text-align:right;\"> 8.718 </td>\n   <td style=\"text-align:right;\"> 57.907 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.050 </td>\n   <td style=\"text-align:right;\"> 0.355 </td>\n   <td style=\"text-align:right;\"> 0.459 </td>\n   <td style=\"text-align:right;\"> 0.220 </td>\n   <td style=\"text-align:right;\"> 7.359 </td>\n   <td style=\"text-align:right;\"> 58.648 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.055 </td>\n   <td style=\"text-align:right;\"> 0.384 </td>\n   <td style=\"text-align:right;\"> 0.455 </td>\n   <td style=\"text-align:right;\"> 0.228 </td>\n   <td style=\"text-align:right;\"> 6.362 </td>\n   <td style=\"text-align:right;\"> 59.535 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.060 </td>\n   <td style=\"text-align:right;\"> 0.412 </td>\n   <td style=\"text-align:right;\"> 0.448 </td>\n   <td style=\"text-align:right;\"> 0.234 </td>\n   <td style=\"text-align:right;\"> 5.559 </td>\n   <td style=\"text-align:right;\"> 60.563 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.065 </td>\n   <td style=\"text-align:right;\"> 0.439 </td>\n   <td style=\"text-align:right;\"> 0.442 </td>\n   <td style=\"text-align:right;\"> 0.239 </td>\n   <td style=\"text-align:right;\"> 4.955 </td>\n   <td style=\"text-align:right;\"> 61.729 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.070 </td>\n   <td style=\"text-align:right;\"> 0.466 </td>\n   <td style=\"text-align:right;\"> 0.438 </td>\n   <td style=\"text-align:right;\"> 0.244 </td>\n   <td style=\"text-align:right;\"> 4.430 </td>\n   <td style=\"text-align:right;\"> 63.027 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.075 </td>\n   <td style=\"text-align:right;\"> 0.271 </td>\n   <td style=\"text-align:right;\"> 0.452 </td>\n   <td style=\"text-align:right;\"> 0.198 </td>\n   <td style=\"text-align:right;\"> 12.494 </td>\n   <td style=\"text-align:right;\"> 63.309 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.080 </td>\n   <td style=\"text-align:right;\"> 0.272 </td>\n   <td style=\"text-align:right;\"> 0.457 </td>\n   <td style=\"text-align:right;\"> 0.199 </td>\n   <td style=\"text-align:right;\"> 12.582 </td>\n   <td style=\"text-align:right;\"> 63.309 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.085 </td>\n   <td style=\"text-align:right;\"> 0.271 </td>\n   <td style=\"text-align:right;\"> 0.464 </td>\n   <td style=\"text-align:right;\"> 0.200 </td>\n   <td style=\"text-align:right;\"> 12.799 </td>\n   <td style=\"text-align:right;\"> 63.309 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.090 </td>\n   <td style=\"text-align:right;\"> 0.271 </td>\n   <td style=\"text-align:right;\"> 0.470 </td>\n   <td style=\"text-align:right;\"> 0.200 </td>\n   <td style=\"text-align:right;\"> 12.950 </td>\n   <td style=\"text-align:right;\"> 63.309 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.095 </td>\n   <td style=\"text-align:right;\"> 0.271 </td>\n   <td style=\"text-align:right;\"> 0.476 </td>\n   <td style=\"text-align:right;\"> 0.201 </td>\n   <td style=\"text-align:right;\"> 13.072 </td>\n   <td style=\"text-align:right;\"> 63.309 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.100 </td>\n   <td style=\"text-align:right;\"> 0.271 </td>\n   <td style=\"text-align:right;\"> 0.481 </td>\n   <td style=\"text-align:right;\"> 0.202 </td>\n   <td style=\"text-align:right;\"> 13.233 </td>\n   <td style=\"text-align:right;\"> 63.309 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nA few observations:\n\n1) with recovery rates higher than 0.07 the fits do no change much\n2) when the rate changes from 0.04 to 0.045, we switch to a different region of the parameter space. Similarly from 0.065 to 0.07\n3) looks like we have four ranges of rates with qualitative shifts:\n     - ***0.005 to 0.02:*** the fits are very similar and prop_ltm is ~ 0.8. The other parameters change proportionally to the rate\n     - ***0.025 to 0.04:*** fits get progressively worse. the other parameters still changes similarly to the first group, but tau is not stable. Seems like tau can no longer compensate, leading to worsening fits\n     - ***0.045 to 0.07:*** prop_ltm drops to ~0.45 and stays there. The other parameters again change proportionally to the rate, but they are now in a different region of the parameter space. Fits gradually worsen as we increase the rates\n     - ***0.07 to 0.2:*** prop is now stable at ~0.255. The other parameters change but with very small increments. Fits are identical\n\nHere's a pairs plot with colors indicating the rate group. The plot indicates that the parameter space does not have a smooth gradient, but rather jumps between regions when rate is fixed to different values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_subset <- best_subset |>\n  mutate(par_groups = case_when(\n    rate <= 0.02 ~ \"0.005-0.02\",\n    rate <= 0.04 ~ \"0.025-0.04\",\n    rate <= 0.07 ~ \"0.045-0.07\",\n    TRUE ~ \"0.07-0.2\"\n  ))\n\nbest_subset |>\n  select(prop, prop_ltm, rate, tau, gain, par_groups) |>\n  ggpairs(\n    aes(color = par_groups),\n    diag = list(continuous = \"blankDiag\"),\n    upper = list(continuous = \"points\")\n  ) +\n  theme_pub() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate correlations-1.png){width=816}\n:::\n:::\n\n\nLet's see how this affects the predictions for the different rate groups. It would be too much to plot all the predictions, so I will first plot the predictions for the first and last parameters for each rate group.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_subset |>\n  group_by(par_groups) |>\n  slice(c(1, n())) |>\n  unnest(c(data, pred)) |>\n  mutate(\n    gap = as.factor(gap),\n    rate = as.factor(round(rate, 3))\n  ) |>\n  ggplot(aes(x = gap, y = p_correct, color = chunk)) +\n  geom_point() +\n  geom_line(aes(y = pred, linetype = par_groups, group = interaction(chunk, rate))) +\n  scale_color_discrete(\"First chunk LTM?\") +\n  scale_linetype_discrete(\"Rate\") +\n  facet_grid(rate ~ itemtype) +\n  theme_pub()\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits-1.png){width=816}\n:::\n:::\n\n\nA few observations:\n\n- Rates above 0.045 lead to the same fit, because they cause full recovery from first item to the second with 6 s ISI. We can see that from he plots because the prediction for SP1-3 and sp4-6 (6000 ISI) are the same for all rates above 0.045, meaning no serial position effect from the first to the second chunk. This is completely implausible, so we can rule out rates above 0.045.\n\n### Including SP1-3 in the fits\n\nI will now include SP1-3 in the fits and see if this changes the parameter space.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_subset <- filter(best, exp == 2, exclude_sp1 == FALSE)\n```\n:::\n\n\nHere are the best-fitting parameters for each rate:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_subset |>\n  select(rate, prop, prop_ltm, tau, gain, deviance) |>\n  mutate_all(round, 3) |>\n  kbl() %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> rate </th>\n   <th style=\"text-align:right;\"> prop </th>\n   <th style=\"text-align:right;\"> prop_ltm </th>\n   <th style=\"text-align:right;\"> tau </th>\n   <th style=\"text-align:right;\"> gain </th>\n   <th style=\"text-align:right;\"> deviance </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.005 </td>\n   <td style=\"text-align:right;\"> 0.109 </td>\n   <td style=\"text-align:right;\"> 0.875 </td>\n   <td style=\"text-align:right;\"> 0.091 </td>\n   <td style=\"text-align:right;\"> 92.939 </td>\n   <td style=\"text-align:right;\"> 119.499 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.010 </td>\n   <td style=\"text-align:right;\"> 0.216 </td>\n   <td style=\"text-align:right;\"> 0.869 </td>\n   <td style=\"text-align:right;\"> 0.149 </td>\n   <td style=\"text-align:right;\"> 24.963 </td>\n   <td style=\"text-align:right;\"> 114.013 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.015 </td>\n   <td style=\"text-align:right;\"> 0.303 </td>\n   <td style=\"text-align:right;\"> 0.867 </td>\n   <td style=\"text-align:right;\"> 0.176 </td>\n   <td style=\"text-align:right;\"> 13.406 </td>\n   <td style=\"text-align:right;\"> 110.780 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.020 </td>\n   <td style=\"text-align:right;\"> 0.374 </td>\n   <td style=\"text-align:right;\"> 0.863 </td>\n   <td style=\"text-align:right;\"> 0.189 </td>\n   <td style=\"text-align:right;\"> 9.213 </td>\n   <td style=\"text-align:right;\"> 109.681 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.025 </td>\n   <td style=\"text-align:right;\"> 0.432 </td>\n   <td style=\"text-align:right;\"> 0.860 </td>\n   <td style=\"text-align:right;\"> 0.193 </td>\n   <td style=\"text-align:right;\"> 7.153 </td>\n   <td style=\"text-align:right;\"> 110.370 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> 0.481 </td>\n   <td style=\"text-align:right;\"> 0.859 </td>\n   <td style=\"text-align:right;\"> 0.193 </td>\n   <td style=\"text-align:right;\"> 5.961 </td>\n   <td style=\"text-align:right;\"> 112.559 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.035 </td>\n   <td style=\"text-align:right;\"> 0.527 </td>\n   <td style=\"text-align:right;\"> 0.857 </td>\n   <td style=\"text-align:right;\"> 0.191 </td>\n   <td style=\"text-align:right;\"> 5.106 </td>\n   <td style=\"text-align:right;\"> 116.055 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.040 </td>\n   <td style=\"text-align:right;\"> 0.567 </td>\n   <td style=\"text-align:right;\"> 0.853 </td>\n   <td style=\"text-align:right;\"> 0.187 </td>\n   <td style=\"text-align:right;\"> 4.514 </td>\n   <td style=\"text-align:right;\"> 120.700 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.045 </td>\n   <td style=\"text-align:right;\"> 0.602 </td>\n   <td style=\"text-align:right;\"> 0.853 </td>\n   <td style=\"text-align:right;\"> 0.183 </td>\n   <td style=\"text-align:right;\"> 4.074 </td>\n   <td style=\"text-align:right;\"> 126.391 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.050 </td>\n   <td style=\"text-align:right;\"> 0.640 </td>\n   <td style=\"text-align:right;\"> 0.852 </td>\n   <td style=\"text-align:right;\"> 0.177 </td>\n   <td style=\"text-align:right;\"> 3.679 </td>\n   <td style=\"text-align:right;\"> 133.024 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.055 </td>\n   <td style=\"text-align:right;\"> 0.667 </td>\n   <td style=\"text-align:right;\"> 0.853 </td>\n   <td style=\"text-align:right;\"> 0.172 </td>\n   <td style=\"text-align:right;\"> 3.429 </td>\n   <td style=\"text-align:right;\"> 140.578 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.060 </td>\n   <td style=\"text-align:right;\"> 0.697 </td>\n   <td style=\"text-align:right;\"> 0.852 </td>\n   <td style=\"text-align:right;\"> 0.166 </td>\n   <td style=\"text-align:right;\"> 3.181 </td>\n   <td style=\"text-align:right;\"> 148.930 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.065 </td>\n   <td style=\"text-align:right;\"> 0.723 </td>\n   <td style=\"text-align:right;\"> 0.852 </td>\n   <td style=\"text-align:right;\"> 0.161 </td>\n   <td style=\"text-align:right;\"> 2.992 </td>\n   <td style=\"text-align:right;\"> 158.062 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.070 </td>\n   <td style=\"text-align:right;\"> 0.749 </td>\n   <td style=\"text-align:right;\"> 0.851 </td>\n   <td style=\"text-align:right;\"> 0.155 </td>\n   <td style=\"text-align:right;\"> 2.811 </td>\n   <td style=\"text-align:right;\"> 167.905 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.075 </td>\n   <td style=\"text-align:right;\"> 0.773 </td>\n   <td style=\"text-align:right;\"> 0.853 </td>\n   <td style=\"text-align:right;\"> 0.148 </td>\n   <td style=\"text-align:right;\"> 2.660 </td>\n   <td style=\"text-align:right;\"> 178.428 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.080 </td>\n   <td style=\"text-align:right;\"> 0.793 </td>\n   <td style=\"text-align:right;\"> 0.854 </td>\n   <td style=\"text-align:right;\"> 0.143 </td>\n   <td style=\"text-align:right;\"> 2.537 </td>\n   <td style=\"text-align:right;\"> 189.595 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.085 </td>\n   <td style=\"text-align:right;\"> 0.816 </td>\n   <td style=\"text-align:right;\"> 0.852 </td>\n   <td style=\"text-align:right;\"> 0.136 </td>\n   <td style=\"text-align:right;\"> 2.405 </td>\n   <td style=\"text-align:right;\"> 201.389 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.090 </td>\n   <td style=\"text-align:right;\"> 0.836 </td>\n   <td style=\"text-align:right;\"> 0.854 </td>\n   <td style=\"text-align:right;\"> 0.130 </td>\n   <td style=\"text-align:right;\"> 2.300 </td>\n   <td style=\"text-align:right;\"> 213.730 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.095 </td>\n   <td style=\"text-align:right;\"> 0.855 </td>\n   <td style=\"text-align:right;\"> 0.855 </td>\n   <td style=\"text-align:right;\"> 0.124 </td>\n   <td style=\"text-align:right;\"> 2.203 </td>\n   <td style=\"text-align:right;\"> 226.585 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.100 </td>\n   <td style=\"text-align:right;\"> 0.873 </td>\n   <td style=\"text-align:right;\"> 0.855 </td>\n   <td style=\"text-align:right;\"> 0.118 </td>\n   <td style=\"text-align:right;\"> 2.115 </td>\n   <td style=\"text-align:right;\"> 239.930 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThis now looks much more stable. Until 0.130 we don't have switchest in the parameter region. Still, rates 0.005-0.03 are very similar.\n\nHere are the plots for rates 0.005-0.10:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_data <- best_subset |>\n  unnest(c(data, pred)) |>\n  mutate(\n    gap = as.factor(gap),\n    rate = round(rate, 3)\n  )\n\nmyplot <- function(data) {\n  ggplot(data, aes(x = gap, y = p_correct, color = chunk)) +\n    geom_point() +\n    geom_line(aes(y = pred, group = chunk)) +\n    scale_color_discrete(\"First chunk LTM?\") +\n    facet_grid(rate ~ itemtype) +\n    theme_pub()\n}\n```\n:::\n\n\n::: {.panel-tabset}\n\n## Rate [0.005, 0.025]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyplot(filter(pred_data, rate < 0.026))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits sp1 1-1.png){width=768}\n:::\n:::\n\n\n## Rate [0.03, 0.05]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyplot(filter(pred_data, rate < 0.051 & rate > 0.029))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits sp1 2-1.png){width=768}\n:::\n:::\n\n\n## Rate [0.055, 0.75]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyplot(filter(pred_data, rate < 0.076 & rate > 0.054))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits sp1 3-1.png){width=768}\n:::\n:::\n\n\n## Rate [0.08, 0.10]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyplot(filter(pred_data, rate > 0.079, rate < 0.101))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits sp1 4-1.png){width=768}\n:::\n:::\n\n\n:::\n\n## What about experiment 1?\n\nI will now repeat the same analysis for experiment 1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_subset <- filter(best, exp == 1, exclude_sp1)\n\nbest_subset |>\n  select(rate, prop, prop_ltm, tau, gain, deviance) |>\n  mutate_all(round, 3) |>\n  kbl() %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> rate </th>\n   <th style=\"text-align:right;\"> prop </th>\n   <th style=\"text-align:right;\"> prop_ltm </th>\n   <th style=\"text-align:right;\"> tau </th>\n   <th style=\"text-align:right;\"> gain </th>\n   <th style=\"text-align:right;\"> deviance </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 0.005 </td>\n   <td style=\"text-align:right;\"> 0.106 </td>\n   <td style=\"text-align:right;\"> 0.573 </td>\n   <td style=\"text-align:right;\"> 0.089 </td>\n   <td style=\"text-align:right;\"> 100.000 </td>\n   <td style=\"text-align:right;\"> 36.273 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.010 </td>\n   <td style=\"text-align:right;\"> 0.115 </td>\n   <td style=\"text-align:right;\"> 0.576 </td>\n   <td style=\"text-align:right;\"> 0.096 </td>\n   <td style=\"text-align:right;\"> 85.610 </td>\n   <td style=\"text-align:right;\"> 31.959 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.015 </td>\n   <td style=\"text-align:right;\"> 0.170 </td>\n   <td style=\"text-align:right;\"> 0.579 </td>\n   <td style=\"text-align:right;\"> 0.129 </td>\n   <td style=\"text-align:right;\"> 40.879 </td>\n   <td style=\"text-align:right;\"> 32.380 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.020 </td>\n   <td style=\"text-align:right;\"> 0.223 </td>\n   <td style=\"text-align:right;\"> 0.587 </td>\n   <td style=\"text-align:right;\"> 0.154 </td>\n   <td style=\"text-align:right;\"> 24.841 </td>\n   <td style=\"text-align:right;\"> 33.079 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.025 </td>\n   <td style=\"text-align:right;\"> 0.270 </td>\n   <td style=\"text-align:right;\"> 0.593 </td>\n   <td style=\"text-align:right;\"> 0.172 </td>\n   <td style=\"text-align:right;\"> 17.465 </td>\n   <td style=\"text-align:right;\"> 34.078 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> 0.314 </td>\n   <td style=\"text-align:right;\"> 0.600 </td>\n   <td style=\"text-align:right;\"> 0.184 </td>\n   <td style=\"text-align:right;\"> 13.397 </td>\n   <td style=\"text-align:right;\"> 35.384 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.035 </td>\n   <td style=\"text-align:right;\"> 0.351 </td>\n   <td style=\"text-align:right;\"> 0.602 </td>\n   <td style=\"text-align:right;\"> 0.192 </td>\n   <td style=\"text-align:right;\"> 11.022 </td>\n   <td style=\"text-align:right;\"> 37.002 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.040 </td>\n   <td style=\"text-align:right;\"> 0.384 </td>\n   <td style=\"text-align:right;\"> 0.605 </td>\n   <td style=\"text-align:right;\"> 0.197 </td>\n   <td style=\"text-align:right;\"> 9.416 </td>\n   <td style=\"text-align:right;\"> 38.918 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.045 </td>\n   <td style=\"text-align:right;\"> 0.413 </td>\n   <td style=\"text-align:right;\"> 0.607 </td>\n   <td style=\"text-align:right;\"> 0.200 </td>\n   <td style=\"text-align:right;\"> 8.305 </td>\n   <td style=\"text-align:right;\"> 41.117 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.050 </td>\n   <td style=\"text-align:right;\"> 0.439 </td>\n   <td style=\"text-align:right;\"> 0.608 </td>\n   <td style=\"text-align:right;\"> 0.202 </td>\n   <td style=\"text-align:right;\"> 7.448 </td>\n   <td style=\"text-align:right;\"> 43.575 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.055 </td>\n   <td style=\"text-align:right;\"> 0.457 </td>\n   <td style=\"text-align:right;\"> 0.603 </td>\n   <td style=\"text-align:right;\"> 0.204 </td>\n   <td style=\"text-align:right;\"> 6.888 </td>\n   <td style=\"text-align:right;\"> 46.274 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.060 </td>\n   <td style=\"text-align:right;\"> 0.481 </td>\n   <td style=\"text-align:right;\"> 0.603 </td>\n   <td style=\"text-align:right;\"> 0.205 </td>\n   <td style=\"text-align:right;\"> 6.310 </td>\n   <td style=\"text-align:right;\"> 49.177 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.065 </td>\n   <td style=\"text-align:right;\"> 0.497 </td>\n   <td style=\"text-align:right;\"> 0.598 </td>\n   <td style=\"text-align:right;\"> 0.206 </td>\n   <td style=\"text-align:right;\"> 5.889 </td>\n   <td style=\"text-align:right;\"> 52.249 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.070 </td>\n   <td style=\"text-align:right;\"> 0.510 </td>\n   <td style=\"text-align:right;\"> 0.594 </td>\n   <td style=\"text-align:right;\"> 0.207 </td>\n   <td style=\"text-align:right;\"> 5.570 </td>\n   <td style=\"text-align:right;\"> 55.470 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.075 </td>\n   <td style=\"text-align:right;\"> 0.405 </td>\n   <td style=\"text-align:right;\"> 0.374 </td>\n   <td style=\"text-align:right;\"> 0.221 </td>\n   <td style=\"text-align:right;\"> 7.375 </td>\n   <td style=\"text-align:right;\"> 56.971 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.080 </td>\n   <td style=\"text-align:right;\"> 0.423 </td>\n   <td style=\"text-align:right;\"> 0.369 </td>\n   <td style=\"text-align:right;\"> 0.225 </td>\n   <td style=\"text-align:right;\"> 6.802 </td>\n   <td style=\"text-align:right;\"> 58.529 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.085 </td>\n   <td style=\"text-align:right;\"> 0.441 </td>\n   <td style=\"text-align:right;\"> 0.367 </td>\n   <td style=\"text-align:right;\"> 0.228 </td>\n   <td style=\"text-align:right;\"> 6.311 </td>\n   <td style=\"text-align:right;\"> 60.169 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.090 </td>\n   <td style=\"text-align:right;\"> 0.457 </td>\n   <td style=\"text-align:right;\"> 0.364 </td>\n   <td style=\"text-align:right;\"> 0.230 </td>\n   <td style=\"text-align:right;\"> 5.910 </td>\n   <td style=\"text-align:right;\"> 61.889 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.095 </td>\n   <td style=\"text-align:right;\"> 0.474 </td>\n   <td style=\"text-align:right;\"> 0.360 </td>\n   <td style=\"text-align:right;\"> 0.232 </td>\n   <td style=\"text-align:right;\"> 5.534 </td>\n   <td style=\"text-align:right;\"> 63.682 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 0.100 </td>\n   <td style=\"text-align:right;\"> 0.490 </td>\n   <td style=\"text-align:right;\"> 0.357 </td>\n   <td style=\"text-align:right;\"> 0.234 </td>\n   <td style=\"text-align:right;\"> 5.222 </td>\n   <td style=\"text-align:right;\"> 65.541 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nsimilar switch at 0.075 to a different region of the parameter space. \n\nHere are the plots for rates 0.005-0.10:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_data <- best_subset |>\n  unnest(c(data, pred)) |>\n  mutate(\n    gap = as.factor(gap),\n    rate = round(rate, 3)\n  )\n```\n:::\n\n\n\n::: {.panel-tabset}\n\n## Rate [0.005, 0.025]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyplot(filter(pred_data, rate < 0.026))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits 1 (exp1)-1.png){width=768}\n:::\n:::\n\n\n## Rate [0.03, 0.05]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyplot(filter(pred_data, rate < 0.051 & rate > 0.029))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits 2 (exp1)-1.png){width=768}\n:::\n:::\n\n\n## Rate [0.055, 0.75]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyplot(filter(pred_data, rate < 0.076 & rate > 0.054))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits 3 (exp1)-1.png){width=768}\n:::\n:::\n\n\n## Rate [0.08, 0.10]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyplot(filter(pred_data, rate > 0.079, rate < 0.101))\n```\n\n::: {.cell-output-display}\n![](par_identifiability_files/figure-html/plot rate fits 4 (exp1)-1.png){width=768}\n:::\n:::\n\n\n:::\n\nso even a rate of 0.07 does not necessarily predict a big interaction\n\n## Summary\n\n- The parameter space is not smooth, but rather jumps between regions when rate is fixed to different values\n- There are ridges in the parameter space where the fits are very similar\n",
    "supporting": [
      "par_identifiability_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}